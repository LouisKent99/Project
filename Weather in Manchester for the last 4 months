# -*- coding: utf-8 -*-
"""
Created on Thu Apr 28 12:55:05 2022

@author: louis
"""

import requests 
import json
import numpy as np

def json_extract(obj, key):
    """Recursively fetch values from nested JSON."""
    arr = []

    def extract(obj, arr, key):
        """Recursively search for values of key in JSON tree."""
        if isinstance(obj, dict):
            for k, v in obj.items():
                if isinstance(v, (dict, list)):
                    extract(v, arr, key)
                elif k == key:
                    arr.append(v)
        elif isinstance(obj, list):
            for item in obj:
                extract(item, arr, key)
        return arr

    values = extract(obj, arr, key)
    return values

parameters = {
    
    
    }
response = requests.get("http://api.worldweatheronline.com/premium/v1/past-weather.ashx?key=a91cf711ab9a432aa39115955222804&q=Manchester&format=json&date=2022-01-01&enddate=2022-04-27&includelocation=M19 2FU")
print(response.status_code)

def jprint(obj):
    # create a formatted string of the Python JSON object
    text = json.dumps(obj, sort_keys=True, indent=4)
    print(text)
    
jprint(response.json())

dates = np.repeat(json_extract(response.json(),'date'),8)

times = np.array(json_extract(response.json(),'time'))

temps = np.array(json_extract(response.json(),'tempC'))

winds = np.array(json_extract(response.json(),'windspeedKmph'))

precips = np.array(json_extract(response.json(),'precipMM'))

vis = np.array(json_extract(response.json(),'visibility'))

import pandas as pd

weather = np.column_stack((dates,times,temps,winds,precips,vis),)
weather = pd.DataFrame(weather)
weather.columns = ['Date','Time','Temp','Wind','Precip','Visibility']
print(weather)



